import{a as Y}from"./chunk-IQIRIRRD.js";import"./chunk-XZ5FKYM5.js";import{a as H}from"./chunk-S4WINN2R.js";import{b as U,d as M,f as O,g as N,h as G,l as L,p as z,q as A,v as j,w as R,x as $}from"./chunk-43DCFWML.js";import{n as q,p as B}from"./chunk-2QNACWOQ.js";import{Ac as P,Cb as u,Eb as h,Nb as a,Ob as I,Pa as y,Pb as k,Sa as s,Ta as d,Vb as w,ea as x,hb as p,ib as V,jb as m,ma as _,na as b,ob as C,rb as S,sb as T,tb as r,ua as F,ub as n,vb as g,xc as D,zb as E}from"./chunk-53WIH66V.js";import"./chunk-6GU5JNHE.js";var Z=(i,l)=>l._id;function J(i,l){i&1&&(r(0,"div"),a(1," Vehicle Name is required "),n())}function K(i,l){i&1&&(r(0,"div"),a(1," Vehicle Name is start with min 3 alphabet "),n())}function Q(i,l){if(i&1&&(r(0,"div",17),p(1,J,2,0,"div",18)(2,K,2,0,"div",18),n()),i&2){let c,e,t=h();s(),m("ngIf",(c=t.vehicleForm.get("vname").errors)==null?null:c.required),s(),m("ngIf",(e=t.vehicleForm.get("vname").errors)==null?null:e.customPattern)}}function W(i,l){i&1&&(r(0,"div",17),a(1,"File size exceeds 5MB"),n())}function X(i,l){i&1&&(r(0,"div",17),a(1,"Invalid file type. Only PNG and JPEG allowed."),n())}function ee(i,l){i&1&&(r(0,"div",13),a(1," ! Image is required"),n())}function te(i,l){if(i&1){let c=E();r(0,"button",19),u("click",function(){_(c);let t=h();return b(t.update())}),a(1,"Update"),n()}}function ie(i,l){i&1&&(r(0,"button",20),a(1,"Submit"),n())}function ne(i,l){if(i&1){let c=E();r(0,"tr")(1,"td"),a(2),n(),r(3,"td"),g(4,"img",24),n(),r(5,"td")(6,"button",25),u("click",function(){let t=_(c).$implicit,o=h(2);return b(o.editVehicle(t))}),a(7,"Edit"),n()()()}if(i&2){let c=l.$implicit,e=h(2);V("id",c._id),s(2),I(c.vname),s(2),m("src",e.backendUrl+"/uploads/vehicles/"+c.vimage,y)}}function oe(i,l){if(i&1&&(r(0,"div",16)(1,"table",21)(2,"thead")(3,"tr")(4,"th",22),a(5,"Vehicle Name"),n(),r(6,"th",23),a(7,"Vehicle Image"),n(),r(8,"th",22),a(9,"Edit"),n()()(),r(10,"tbody"),S(11,ne,8,3,"tr",null,Z),n()()()),i&2){let c=h();s(11),T(c.vehicles)}}function re(i){return l=>i.test(l.value)?null:{customPattern:!0}}var fe=(()=>{let l=class l{constructor(e,t,o,f,v){this.fb=e,this.vehicleypeService=t,this.toaster=o,this.getdataservice=f,this.elRef=v,this.maxFileSize=5*1024*1024,this.allowedFileTypes=["image/jpeg","image/jpg","image/png"],this.fileSizeError=!1,this.fileTypeError=!1,this.formData=new FormData,this.isimageupdated=!1,this.defaultprofilesrc=`${this.backendUrl}/uploads/defaultv.png`,this.mybackendUrl=B.backendUrl}get backendUrl(){return this.mybackendUrl}ngOnInit(){console.log("ON INIT------------------------"),this.vehicleForm=this.fb.group({vname:["",[M.required,re(/^[a-zA-Z]{3}[a-zA-Z0-9]*$/)]],vimage:[null]}),this.getdata()}markFormGroupTouched(e){Object.values(e.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty(),t instanceof G&&this.markFormGroupTouched(t)})}editVehicle(e){this.isimageupdated=!0,this.updatebtnstatus=!0,this.selectedVehicle=e,console.log("this.selectedVehicle",this.selectedVehicle),console.log("SLECTED IMAGE",this.selectedVehicle.vimage),this.selected_imagename=this.selectedVehicle.vimage,this.defaultprofilesrc=`${this.backendUrl}/uploads/vehicles/${this.selectedVehicle.vimage}`,console.log(this.defaultprofilesrc),this.vehicleForm.patchValue({vname:this.selectedVehicle.vname}),this.index=this.vehicles.findIndex(t=>t._id===e._id),console.log("index",this.index),console.log("Btn is clicked")}onFileInputClick(){this.isimageupdated=!1,this.vehicleForm.touched,this.defaultprofilesrc=`${this.backendUrl}/uploads/defaultv.png`,console.log("--------------ONFILE CLICK------------")}onFileChange(e){console.log("--------------ONFILE CHANGE------------"),this.formData=new FormData;let t=e.target.files[0];if(console.log(t),this.selected_imagename=t.name,t){if(t.size>this.maxFileSize){this.fileSizeError=!0;return}if(!this.allowedFileTypes.includes(t.type)){this.fileTypeError=!0;return}let o=new FileReader;o.onload=()=>{this.defaultprofilesrc=o.result},this.vehicleForm.get("vname").markAsDirty(),o.readAsDataURL(t),this.fileSizeError=!1,this.fileTypeError=!1,this.isimageupdated=!0,this.formData.append("vimage",t)}}update(){this.isimageupdated=!0,this.markFormGroupTouched(this.vehicleForm),this.selectedVehicle._id&&this.selectedVehicle&&this.vehicleForm.valid&&(this.formData.append("vname",this.vehicleForm.value.vname.toUpperCase().trim()),console.log("this.isimageupdated",this.isimageupdated),this.vehicleypeService.updateVehicle("update_vehicle/",this.selectedVehicle._id,this.formData).subscribe({next:e=>{e.success===!0&&(this.toaster.success(e.message,"Success"),console.log(e),console.log(this.index),this.vehicles[this.index].vname=e.data.vname,this.vehicles[this.index].vimage=e.data.vimage)},error:e=>{console.warn("VEHICLE TYPE ERROR-------------------------"),console.log(e),console.log(e.status),e.status===401?(console.log("error 11000"),this.toaster.error(e.error.message,"Duplicate")):e.status===404?this.toaster.error(e.error.message,"User not Found"):(console.log("ELSE UPDATE error"),console.log("Update error is ",e),this.toaster.error(e.message,e.statusText+" "+e.status)),this.formData.delete("vname")},complete:()=>{console.log("COMPLETED VEHICLE TYPE"),this.resetForm(),this.updatebtnstatus=!1}}))}resetForm(){this.vehicleForm.reset(),this.formData=new FormData;let e=this.elRef.nativeElement.querySelector("#vimage");e.value="",this.defaultprofilesrc=`${this.backendUrl}/uploads/defaultv.png`,this.selected_imagename="Drag or drop image here"}onSubmit(){if(this.markFormGroupTouched(this.vehicleForm),!this.isimageupdated){this.toaster.error("please select the image file Before submit","Incomplete Form");return}if(this.vehicleForm.valid&&this.isimageupdated)console.log("vname",this.vehicleForm.value.vname.trim().toUpperCase()),console.log("vimage",this.vehicleForm.value.vimage),this.formData.append("vname",this.vehicleForm.value.vname.trim().toUpperCase()),this.vehicleypeService.addnewVehicle(this.formData).subscribe({next:e=>{e.success===!0&&(this.vehicles.push(e.data),this.toaster.success(e.message,"Success"),this.resetForm())},error:e=>{console.log(e.status),e.status===401?(console.log("error 11000"),this.toaster.error(e.error.message,"Duplicate")):(console.log("ELSE error"),this.toaster.error(e.error.message,"Error")),this.formData.delete("vname")},complete:()=>{console.warn("COMPLETED SUCCESSFULLY"),this.isimageupdated=!1}}),console.log("this.selectedimage",this.selected_imagename);else{this.toaster.error("Incomplete form fields","Invalid form");return}}getdata(){console.log("this one"),this.getdataservice.getAllVehicles().subscribe({next:e=>{if(console.log("this one"),console.log(e),e.success===!0){let t=e.data;console.log(t),this.vehicles=t}},error:e=>{console.log("Get all vehhicles error",e),this.toaster.error(e.error.message,"Error")},complete:()=>{console.log("Completed Getdata")}})}};l.\u0275fac=function(t){return new(t||l)(d(j),d(Y),d(q),d(H),d(F))},l.\u0275cmp=x({type:l,selectors:[["app-vehicle-type"]],standalone:!0,features:[w],decls:24,vars:10,consts:[[1,"container-fluid"],[3,"ngSubmit","formGroup"],["for","vname",1,"my-2"],["type","text","id","vname","formControlName","vname",1,"form-control"],["class","text-danger",4,"ngIf"],["for","vimage",1,"form-label","my-2"],[1,"row","gap-5"],[1,"col-1"],["alt","Preview Image",1,"preview_img",3,"src"],[1,"col-10"],[1,"file-upload","text-secondary"],["type","file","formControlName","vimage","id","vimage",1,"form-control",3,"click","change"],[1,"fs-4","fw-2"],[2,"color","rgb(193, 69, 7)"],["type","button","class","my-3 form-control btn btn-success",3,"click",4,"ngIf"],["type","submit","class","my-3 form-control btn btn-primary",4,"ngIf"],[1,"table-container"],[1,"text-danger"],[4,"ngIf"],["type","button",1,"my-3","form-control","btn","btn-success",3,"click"],["type","submit",1,"my-3","form-control","btn","btn-primary"],[1,"table","table-bordered","table-hover","align-middle",2,"text-align","center"],["width","25%"],["width","50%"],["onerror","this.src=backendUrl+'/uploads/defaultv.png';","alt","Vehicle Image","width","100","height","100",2,"border-radius","50%",3,"src"],[1,"btn","btn-primary",3,"click"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"form",1),u("ngSubmit",function(){return o.onSubmit()}),r(2,"label",2),a(3,"Vehicle Name:"),n(),g(4,"input",3),p(5,Q,3,2,"div",4),r(6,"label",5),a(7,"Vehicle image :"),n(),r(8,"div",6)(9,"div",7),g(10,"img",8),n(),r(11,"div",9)(12,"div",10)(13,"input",11),u("click",function(){return o.onFileInputClick()})("change",function(v){return o.onFileChange(v)}),n(),r(14,"span",12),a(15,"Choose file..."),n(),r(16,"span"),a(17),n()()()(),p(18,W,2,0,"div",4)(19,X,2,0,"div",4)(20,ee,2,0,"div",13)(21,te,2,0,"button",14)(22,ie,2,0,"button",15),n(),p(23,oe,13,0,"div",16),n()),t&2&&(s(),m("formGroup",o.vehicleForm),s(4),m("ngIf",o.vehicleForm.get("vname").invalid&&o.vehicleForm.get("vname").dirty),s(5),m("src",o.defaultprofilesrc,y),s(7),k(" ",o.selected_imagename,""),s(),m("ngIf",o.fileSizeError),s(),m("ngIf",o.fileTypeError),s(),C(20,!o.isimageupdated&&o.vehicleForm.touched?20:-1),s(),m("ngIf",o.updatebtnstatus),s(),m("ngIf",!o.updatebtnstatus),s(),C(23,o.vehicles?23:-1))},dependencies:[P,D,$,L,U,O,N,z,A,R],styles:[".btn-enabled[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;cursor:pointer}.btn-disabled[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;cursor:not-allowed}.btn.no-hover[_ngcontent-%COMP%]:hover{background-color:inherit;border-color:inherit;color:inherit}th[_ngcontent-%COMP%]{background-color:#497fdb;color:#fff}.table-container[_ngcontent-%COMP%]{overflow-y:auto;max-height:630px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{vertical-align:middle}.preview_img[_ngcontent-%COMP%]{margin-left:10px;height:8vw;width:8vw;border-radius:50%;object-fit:cover;border:5px solid rgb(226,242,247)}.file-upload[_ngcontent-%COMP%]{position:relative;align-items:center;justify-content:center;height:7.5vw;padding:30px;border:3px dashed rgb(146,142,142);border-radius:8px}.file-upload[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:100%;width:100%;cursor:pointer;opacity:0;background-color:pink}"]});let i=l;return i})();export{fe as VehicleTypeComponent};

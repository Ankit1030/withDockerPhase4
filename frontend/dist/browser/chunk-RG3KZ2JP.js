import{a as $}from"./chunk-5TMQOYDV.js";import"./chunk-XFWSRHR4.js";import{a as Z}from"./chunk-ONPOCEYN.js";import{b as L,d as U,f as B,g as G,i as P,k as j,l as z,p as H,q,v as Q,w as W,x as Y}from"./chunk-43DCFWML.js";import{n as K}from"./chunk-2GWGYD35.js";import{Ac as A,Cb as g,Eb as b,Jb as w,Kb as M,Lb as T,Nb as i,Ob as p,Pa as N,Rb as I,Sa as s,Sb as D,Ta as f,Tb as k,Vb as O,ea as x,hb as E,jb as h,ma as u,na as m,ob as S,rb as F,sb as V,tb as r,ub as t,vb as y,xc as R,zb as _}from"./chunk-53WIH66V.js";import"./chunk-6GU5JNHE.js";var X=["closeButton"],ee=(l,c)=>c._id;function te(l,c){l&1&&(r(0,"small",14),i(1,"Country name of min length 1 alphabet is required to search"),t())}function oe(l,c){if(l&1&&y(0,"img",36),l&2){let a=b().$implicit;h("src",a.flag,N)}}function ne(l,c){if(l&1&&(r(0,"tr")(1,"td"),i(2),t(),r(3,"td"),i(4),t(),r(5,"td"),i(6),t(),r(7,"td"),E(8,oe,1,1,"img",35),t(),r(9,"td"),i(10),t(),r(11,"td"),i(12),t()()),l&2){let a=c.$implicit;s(2),p(a.cname),s(2),p(a.ccode),s(2),p(a.ccurr),s(2),h("ngIf",a.flag),s(2),p(a.ccallcode),s(2),p(a.tzone)}}function re(l,c){if(l&1){let a=_();r(0,"form",11)(1,"input",29),k("ngModelChange",function(e){u(a);let n=b();return D(n.searchvalue,e)||(n.searchvalue=e),m(e)}),t(),r(2,"button",30),g("click",function(){u(a);let e=b();return m(e.getResult())}),i(3,"Search"),t()(),r(4,"div",31)(5,"div",32)(6,"table",33)(7,"thead")(8,"tr")(9,"th"),i(10,"Country Name"),t(),r(11,"th"),i(12,"Country Code"),t(),r(13,"th"),i(14,"Currency"),t(),r(15,"th"),i(16,"Flag"),t(),r(17,"th"),i(18,"Call Code"),t(),r(19,"th"),i(20,"Time Zone"),t()()(),r(21,"tbody",34),F(22,ne,13,6,"tr",null,ee),t()()()()}if(l&2){let a=b();s(),I("ngModel",a.searchvalue),s(),h("disabled",a.disOutSeabtn),s(20),V(a.allcountries)}}var he=(()=>{let c=class c{constructor(o,e,n,d){this.fb=o,this.vs=e,this.toaster=n,this.getservice=d,this.savecountrydisable=!0,this.disable=!0,this.disablesearchbtn=!0,this.searchterm={},this.sterm=""}ngOnInit(){this.countryForm=this.fb.group({countryName:["",[U.required]],currency:[""],countryCode:[""],countryCallingCode:[""]}),this.disableFormControls(),this.getAllcountry({sterm:""})}disableFormControls(){Object.keys(this.countryForm.controls).forEach(o=>{this.countryForm.get(o).disable()})}openform(){this.countryForm.reset(),this.countryForm.get("countryName").enable()}searchdata(){console.log("------------ KEY PRESS --------------------------------------------------------"),this.cname=this.countryForm.get("countryName").value.trim(),console.log(this.cname);let o=this.cname.trim().length;if(o>0)try{this.vs.getcountryname(this.cname,o).subscribe({next:e=>{if(e){this.flag=e.flags.png,this.tzone=e.timezones[0];let n=e;console.log(e);let d=n.name.common,C=Object.keys(n.currencies)[0],v;n.idd.suffixes.length===1?v=n.idd.root+n.idd.suffixes[0]:v=n.idd.root,console.log(v);let J=n.cca2;this.searchedcountryData={countryName:d,currency:C,countryCode:J,countryCallingCode:v},this.countryForm.setValue(this.searchedcountryData),this.countryForm.get("countryName").disable(),this.disablesearchbtn=!0,this.savecountrydisable=!1,console.log(this.countryForm),this.toaster.success("Country Found ","Success")}else this.toaster.error("No Matching Country Found","! invalid Name")},error:e=>{this.toaster.error("Search server Error","!Server error")},complete:()=>{console.log("COMPLETED  GETCOUNTRY ROUTE")}})}catch(e){console.log("CATCH",e)}else return}clearform(){this.countryForm.reset(),this.countryForm.get("countryName").enable(),this.savecountrydisable=!0}searchfield(){if(console.log("Searchfield----"),this.countryForm.get("countryName").value){console.log("SOMETHING ENTERED --*-***-**-"),this.disablesearchbtn=!1;var o=this.countryForm.get("countryName").value.trim();if(o.length==0){this.disablesearchbtn=!0,console.log("value.length == 0");return}if(o.length>>0&&this.previousValue!==o){console.log("CHANGE-- IF--"),this.disablesearchbtn=!1,this.previousValue=o;return}}else console.warn("No VALUE -----"),this.disablesearchbtn=!0}compareObjects(o,e){for(let n of Object.keys(o))if(o[n]!==e[n])return!1;return!0}onSubmit(){if(console.log("this.countryForm.value",this.countryForm.value),console.log("this.searchedcountryData",this.searchedcountryData),!this.compareObjects(this.countryForm.value,this.searchedcountryData)){console.log("inside manipulating the data-->>>>>>>>>>>>>>>>>>"),this.toaster.warning("Dont manipulate the Data ","Read only data"),this.countryForm.setValue(this.searchedcountryData),this.disableFormControls();return}if(console.log("CALLED SUBMIT-----"),!this.countryForm.get("countryName").disabled){this.toaster.error("Please select the Country","Country not selected");return}console.log("--------INSIDE SUBMIT------------------------------"),console.log("cname",this.countryForm.get("countryName").value.trim()),console.log("ccurr",this.countryForm.get("currency").value),console.log("ccode",this.countryForm.get("countryCode").value),console.log("ccallcode",this.countryForm.get("countryCallingCode").value),console.log("--------INSIDE SUBMIT------------------------------");let o={cname:this.searchedcountryData.countryName,ccurr:this.searchedcountryData.currency,ccode:this.searchedcountryData.countryCode,ccallcode:this.searchedcountryData.countryCallingCode,tzone:this.tzone,flag:this.flag};console.log("cdata",o),this.vs.addcountry(o).subscribe({next:e=>{console.log(e),e.success===!0?(this.allcountries.push(e.data),this.closeModal(),this.toaster.success("Country added Successfully to DB","Success")):this.toaster.error("Country not added Error","Error")},error:e=>{console.log("Add new country Error",e),e.status===409?(this.toaster.error(e.error.message,"Duplicate Entry"),console.error("Country data already exists:",e.error.message)):e.status===500?this.toaster.error("Internal Server Error","Error 500"):this.toaster.error(e.message,e.statusText+" "+e.status)},complete:()=>{console.log("Completed send data to addCountry")}})}getResult(){console.log("GET RESULT");let o=this.searchvalue.trim().toLowerCase();if(o.length===0){console.log("null Trim no req"),this.getAllcountry({sterm:""});return}if(this.previousSearchValue!==o){console.log("this.previousSearchValue",this.previousSearchValue),console.log("searchterm",o),console.log("CHANGE-- IF--"),this.previousSearchValue=o,console.warn("NEW PREVIOUS SEARCHVALUE ",this.previousSearchValue),console.log("searchterm--",o);let e={sterm:o};this.getAllcountry(e);return}}getAllcountry(o){this.getservice.getcountry(o).subscribe({next:e=>{console.log(e),e.data===null&&(this.toaster.error("No Matching result found","No result"),this.allcountries=[],console.warn("Search --- COUNTRIES RECEIVED "),console.log(e.data)),this.allcountries=e.data,console.warn("ALL COUNTRIES RECEIVED SUCCESS")},error:e=>{console.log(e),console.log("GET ALL COUNTRIES ERROR--")},complete:()=>{}})}closeModal(){this.closeButton&&this.closeButton.nativeElement&&this.closeButton.nativeElement.click()}};c.\u0275fac=function(e){return new(e||c)(f(Q),f($),f(K),f(Z))},c.\u0275cmp=x({type:c,selectors:[["app-country"]],viewQuery:function(e,n){if(e&1&&w(X,5),e&2){let d;M(d=T())&&(n.closeButton=d.first)}},standalone:!0,features:[O],decls:45,vars:5,consts:[["addCountryModal",""],["closeButton",""],["type","button","data-bs-toggle","modal","data-bs-target","#addCountryModal",1,"form-control","btn","btn-primary",2,"height","50px","font-size","25px","margin-bottom","-15px",3,"click"],["id","addCountryModal","tabindex","-1","aria-labelledby","addCountryModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","addCountryModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"mb-3"],["for","countryName",1,"form-label"],["type","text","id","countryName","formControlName","countryName",1,"form-control",3,"ngModelChange"],[1,"text-danger"],[1,"row"],[1,"col-6"],["type","button",1,"form-control","btn","btn-success",3,"click","disabled"],["type","button",1,"form-control","btn","btn-dark",3,"click"],[1,"my-2"],["for","currency",1,"form-label"],["type","text","id","currency","formControlName","currency",1,"form-control"],["for","countryCode",1,"form-label"],["type","text","id","countryCode","formControlName","countryCode",1,"form-control"],["for","countryCallingCode",1,"form-label"],["type","text","id","countryCallingCode","formControlName","countryCallingCode",1,"form-control"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["name","searchvalue","ngModal","","placeholder","Search","aria-label","Search",1,"form-control","my-2",3,"ngModelChange","ngModel"],["type","button",1,"form-control","btn","btn-dark","my-2","my-sm-0",3,"click","disabled"],[1,"table-c"],[1,"responsive"],[1,"table","table-bordered","table-hover","align-middle",2,"text-align","center"],[1,"align-middle"],["style","width: 50px; height:30px;","alt","Flag",3,"src",4,"ngIf"],["alt","Flag",2,"width","50px","height","30px",3,"src"]],template:function(e,n){if(e&1){let d=_();r(0,"button",2),g("click",function(){return u(d),m(n.openform())}),i(1," + Add Country "),t(),r(2,"div",3,0)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h5",7),i(8,"Add Country"),t(),y(9,"button",8),t(),r(10,"div",9)(11,"form",10)(12,"div",11)(13,"label",12),i(14,"Country Name:"),t(),r(15,"input",13),g("ngModelChange",function(){return u(d),m(n.searchfield())}),t(),E(16,te,2,0,"small",14),t(),r(17,"div",15)(18,"div",16)(19,"button",17),g("click",function(){return u(d),m(n.searchdata())}),i(20,"Search"),t()(),r(21,"div",16)(22,"button",18),g("click",function(){return u(d),m(n.clearform())}),i(23,"Clear"),t()()(),r(24,"div",19)(25,"label",20),i(26,"Currency:"),t(),y(27,"input",21),t(),r(28,"div",11)(29,"label",22),i(30,"Country Code:"),t(),y(31,"input",23),t(),r(32,"div",11)(33,"label",24),i(34,"Country Calling Code:"),t(),y(35,"input",25),t()()(),r(36,"div",26)(37,"button",27,1),i(39,"Close"),t(),r(40,"button",28),g("click",function(){return u(d),m(n.onSubmit())}),i(41,"Save Country"),t()()()()(),y(42,"br")(43,"br"),E(44,re,24,2)}e&2&&(s(11),h("formGroup",n.countryForm),s(5),S(16,n.disablesearchbtn&&n.countryForm.get("countryName").value==""?16:-1),s(3),h("disabled",n.disablesearchbtn),s(21),h("disabled",n.savecountrydisable),s(4),S(44,n.allcountries?44:-1))},dependencies:[A,R,Y,z,L,B,G,H,q,W,j,P],styles:["th[_ngcontent-%COMP%]{background-color:#497fdb;color:#fff}.table-c[_ngcontent-%COMP%]{overflow-y:auto;max-height:650px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{vertical-align:middle;font-size:18px}"]});let l=c;return l})();export{he as CountryComponent};
